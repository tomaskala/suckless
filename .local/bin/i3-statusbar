#!/bin/sh

render() {
  muted=$(pamixer --get-mute)
  vol_perc=$(pamixer --get-volume)
  current_date=$(date +'%a %F')
  current_time=$(date +'%H:%M')

  if [ "${muted}" = true ]; then
    vol_status='ğŸ”‡'
  elif [ "${vol_perc}" -le 30 ]; then
    vol_status='ğŸ”ˆ'
  elif [ "${vol_perc}" -le 70 ]; then
    vol_status='ğŸ”‰'
  else
    vol_status='ğŸ”Š'
  fi

  printf '%s %d%% ğŸ“… %s ğŸ•“ %s\n' \
    "${vol_status}" \
    "${vol_perc}" \
    "${current_date}" \
    "${current_time}"
}

trap render USR1

while true; do
  render
  sleep 1 &
  wait $!
done
